{"version":3,"names":["_interactivity","require","_styles","_getConfig$navigation","_getRequireWildcardCache","e","WeakMap","r","t","_interopRequireWildcard","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","directivePrefix","getRegionRootFragment","initialVdom","toVdom","render","parseServerData","populateServerData","batch","privateApis","navigationMode","getConfig","pages","Map","getPagePath","url","URL","window","location","href","pathname","search","fetchPage","html","res","fetch","status","text","dom","DOMParser","parseFromString","regionsToVdom","baseUrl","vdom","regions","body","undefined","styles","generateCSSStyleSheets","scriptModules","querySelectorAll","map","s","src","globalThis","IS_GUTENBERG_PLUGIN","document","attrName","forEach","region","id","getAttribute","title","querySelector","innerText","initialData","renderRegions","page","Promise","all","specifier","then","sheets","element","remove","adoptedStyleSheets","fragment","forcePageReload","assign","addEventListener","pagePath","state","reload","resolve","isValidLink","ref","HTMLAnchorElement","target","origin","startsWith","searchParams","isValidEvent","event","button","metaKey","ctrlKey","altKey","shiftKey","defaultPrevented","navigatingTo","hasLoadedNavigationTextsData","navigationTexts","loading","loaded","actions","store","navigation","isLoading","hasStarted","hasFinished","navigate","options","clientNavigationDisabled","loadingAnimation","screenReaderAnnouncement","timeout","prefetch","timeoutPromise","setTimeout","loadingTimeout","a11ySpeak","race","clearTimeout","config","history","replace","hash","scrollIntoView","force","exports","messageKey","content","getElementById","textContent","parsed","JSON","parse","i18n","texts","message","speak","closest","preventDefault","nodeName"],"sources":["@wordpress/interactivity-router/src/index.ts"],"sourcesContent":["/**\n * WordPress dependencies\n */\nimport { store, privateApis, getConfig } from '@wordpress/interactivity';\n\n/**\n * Internal dependencies\n */\nimport { generateCSSStyleSheets } from './assets/styles';\n\nconst {\n\tdirectivePrefix,\n\tgetRegionRootFragment,\n\tinitialVdom,\n\ttoVdom,\n\trender,\n\tparseServerData,\n\tpopulateServerData,\n\tbatch,\n} = privateApis(\n\t'I acknowledge that using private APIs means my theme or plugin will inevitably break in the next version of WordPress.'\n);\n\ninterface NavigateOptions {\n\tforce?: boolean;\n\thtml?: string;\n\treplace?: boolean;\n\ttimeout?: number;\n\tloadingAnimation?: boolean;\n\tscreenReaderAnnouncement?: boolean;\n}\n\ninterface PrefetchOptions {\n\tforce?: boolean;\n\thtml?: string;\n}\n\ninterface VdomParams {\n\tvdom?: typeof initialVdom;\n\tbaseUrl?: string;\n}\n\ninterface Page {\n\tregions: Record< string, any >;\n\tstyles: Promise< CSSStyleSheet >[];\n\tscriptModules: string[];\n\ttitle: string;\n\tinitialData: any;\n}\n\ntype RegionsToVdom = ( dom: Document, params?: VdomParams ) => Page;\n\n// Check if the navigation mode is full page or region based.\nconst navigationMode: 'regionBased' | 'fullPage' =\n\tgetConfig( 'core/router' ).navigationMode ?? 'regionBased';\n\n// The cache of visited and prefetched pages, stylesheets and scripts.\nconst pages = new Map< string, Promise< Page | false > >();\n\n// Helper to remove domain and hash from the URL. We are only interesting in\n// caching the path and the query.\nconst getPagePath = ( url: string ) => {\n\tconst u = new URL( url, window.location.href );\n\treturn u.pathname + u.search;\n};\n\n// Fetch a new page and convert it to a static virtual DOM.\nconst fetchPage = async ( url: string, { html }: { html: string } ) => {\n\ttry {\n\t\tif ( ! html ) {\n\t\t\tconst res = await window.fetch( url );\n\t\t\tif ( res.status !== 200 ) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\thtml = await res.text();\n\t\t}\n\t\tconst dom = new window.DOMParser().parseFromString( html, 'text/html' );\n\t\treturn regionsToVdom( dom, { baseUrl: url } );\n\t} catch ( e ) {\n\t\treturn false;\n\t}\n};\n\n// Return an object with VDOM trees of those HTML regions marked with a\n// `router-region` directive.\nconst regionsToVdom: RegionsToVdom = ( dom, { vdom, baseUrl } = {} ) => {\n\tconst regions = { body: undefined };\n\tconst styles = generateCSSStyleSheets( dom, baseUrl );\n\tconst scriptModules = [\n\t\t...dom.querySelectorAll< HTMLScriptElement >(\n\t\t\t'script[type=module][src]'\n\t\t),\n\t].map( ( s ) => s.src );\n\n\tif ( globalThis.IS_GUTENBERG_PLUGIN ) {\n\t\tif ( navigationMode === 'fullPage' ) {\n\t\t\tregions.body = vdom\n\t\t\t\t? vdom.get( document.body )\n\t\t\t\t: toVdom( dom.body );\n\t\t}\n\t}\n\tif ( navigationMode === 'regionBased' ) {\n\t\tconst attrName = `data-${ directivePrefix }-router-region`;\n\t\tdom.querySelectorAll( `[${ attrName }]` ).forEach( ( region ) => {\n\t\t\tconst id = region.getAttribute( attrName );\n\t\t\tregions[ id ] = vdom?.has( region )\n\t\t\t\t? vdom.get( region )\n\t\t\t\t: toVdom( region );\n\t\t} );\n\t}\n\tconst title = dom.querySelector( 'title' )?.innerText;\n\tconst initialData = parseServerData( dom );\n\treturn { regions, styles, scriptModules, title, initialData };\n};\n\n// Render all interactive regions contained in the given page.\nconst renderRegions = async ( page: Page ) => {\n\t// Wait for styles and modules to be ready.\n\tawait Promise.all( [\n\t\t...page.styles,\n\t\t...page.scriptModules.map(\n\t\t\t( src ) => import( /* webpackIgnore: true */ src )\n\t\t),\n\t] );\n\t// Replace style sheets.\n\tconst sheets = await Promise.all( page.styles );\n\twindow.document\n\t\t.querySelectorAll( 'style,link[rel=stylesheet]' )\n\t\t.forEach( ( element ) => element.remove() );\n\twindow.document.adoptedStyleSheets = sheets;\n\n\tif ( globalThis.IS_GUTENBERG_PLUGIN ) {\n\t\tif ( navigationMode === 'fullPage' ) {\n\t\t\t// Update HTML.\n\t\t\tconst fragment = getRegionRootFragment( document.body );\n\t\t\tbatch( () => {\n\t\t\t\tpopulateServerData( page.initialData );\n\t\t\t\trender( page.regions.body, fragment );\n\t\t\t} );\n\t\t}\n\t}\n\tif ( navigationMode === 'regionBased' ) {\n\t\tconst attrName = `data-${ directivePrefix }-router-region`;\n\t\tbatch( () => {\n\t\t\tpopulateServerData( page.initialData );\n\t\t\tdocument\n\t\t\t\t.querySelectorAll( `[${ attrName }]` )\n\t\t\t\t.forEach( ( region ) => {\n\t\t\t\t\tconst id = region.getAttribute( attrName );\n\t\t\t\t\tconst fragment = getRegionRootFragment( region );\n\t\t\t\t\trender( page.regions[ id ], fragment );\n\t\t\t\t} );\n\t\t} );\n\t}\n\tif ( page.title ) {\n\t\tdocument.title = page.title;\n\t}\n};\n\n/**\n * Load the given page forcing a full page reload.\n *\n * The function returns a promise that won't resolve, useful to prevent any\n * potential feedback indicating that the navigation has finished while the new\n * page is being loaded.\n *\n * @param href The page href.\n * @return Promise that never resolves.\n */\nconst forcePageReload = ( href: string ) => {\n\twindow.location.assign( href );\n\treturn new Promise( () => {} );\n};\n\n// Listen to the back and forward buttons and restore the page if it's in the\n// cache.\nwindow.addEventListener( 'popstate', async () => {\n\tconst pagePath = getPagePath( window.location.href ); // Remove hash.\n\tconst page = pages.has( pagePath ) && ( await pages.get( pagePath ) );\n\tif ( page ) {\n\t\tawait renderRegions( page );\n\t\t// Update the URL in the state.\n\t\tstate.url = window.location.href;\n\t} else {\n\t\twindow.location.reload();\n\t}\n} );\n\n// Initialize the router and cache the initial page using the initial vDOM.\n// Once this code is tested and more mature, the head should be updated for\n// region based navigation as well.\npages.set(\n\tgetPagePath( window.location.href ),\n\tPromise.resolve(\n\t\tregionsToVdom( document, {\n\t\t\tvdom: initialVdom,\n\t\t\tbaseUrl: window.location.href,\n\t\t} )\n\t)\n);\n\n// Check if the link is valid for client-side navigation.\nconst isValidLink = ( ref: HTMLAnchorElement ) =>\n\tref &&\n\tref instanceof window.HTMLAnchorElement &&\n\tref.href &&\n\t( ! ref.target || ref.target === '_self' ) &&\n\tref.origin === window.location.origin &&\n\t! ref.pathname.startsWith( '/wp-admin' ) &&\n\t! ref.pathname.startsWith( '/wp-login.php' ) &&\n\t! ref.getAttribute( 'href' ).startsWith( '#' ) &&\n\t! new URL( ref.href ).searchParams.has( '_wpnonce' );\n\n// Check if the event is valid for client-side navigation.\nconst isValidEvent = ( event: MouseEvent ) =>\n\tevent &&\n\tevent.button === 0 && // Left clicks only.\n\t! event.metaKey && // Open in new tab (Mac).\n\t! event.ctrlKey && // Open in new tab (Windows).\n\t! event.altKey && // Download.\n\t! event.shiftKey &&\n\t! event.defaultPrevented;\n\n// Variable to store the current navigation.\nlet navigatingTo = '';\n\nlet hasLoadedNavigationTextsData = false;\nconst navigationTexts = {\n\tloading: 'Loading page, please wait.',\n\tloaded: 'Page Loaded.',\n};\n\ninterface Store {\n\tstate: {\n\t\turl: string;\n\t\tnavigation: {\n\t\t\tisLoading: boolean;\n\t\t\thasStarted: boolean;\n\t\t\thasFinished: boolean;\n\t\t};\n\t};\n\tactions: {\n\t\tnavigate: ( href: string, options?: NavigateOptions ) => void;\n\t\tprefetch: ( url: string, options?: PrefetchOptions ) => void;\n\t};\n}\n\nexport const { state, actions } = store< Store >( 'core/router', {\n\tstate: {\n\t\turl: window.location.href,\n\t\tnavigation: {\n\t\t\tisLoading: false,\n\t\t\thasStarted: false,\n\t\t\thasFinished: false,\n\t\t},\n\t},\n\tactions: {\n\t\t/**\n\t\t * Navigates to the specified page.\n\t\t *\n\t\t * This function normalizes the passed href, fetches the page HTML if\n\t\t * needed, and updates any interactive regions whose contents have\n\t\t * changed. It also creates a new entry in the browser session history.\n\t\t *\n\t\t * @param href                               The page href.\n\t\t * @param [options]                          Options object.\n\t\t * @param [options.force]                    If true, it forces re-fetching the URL.\n\t\t * @param [options.html]                     HTML string to be used instead of fetching the requested URL.\n\t\t * @param [options.replace]                  If true, it replaces the current entry in the browser session history.\n\t\t * @param [options.timeout]                  Time until the navigation is aborted, in milliseconds. Default is 10000.\n\t\t * @param [options.loadingAnimation]         Whether an animation should be shown while navigating. Default to `true`.\n\t\t * @param [options.screenReaderAnnouncement] Whether a message for screen readers should be announced while navigating. Default to `true`.\n\t\t *\n\t\t * @return  Promise that resolves once the navigation is completed or aborted.\n\t\t */\n\t\t*navigate( href: string, options: NavigateOptions = {} ) {\n\t\t\tconst { clientNavigationDisabled } = getConfig();\n\t\t\tif ( clientNavigationDisabled ) {\n\t\t\t\tyield forcePageReload( href );\n\t\t\t}\n\n\t\t\tconst pagePath = getPagePath( href );\n\t\t\tconst { navigation } = state;\n\t\t\tconst {\n\t\t\t\tloadingAnimation = true,\n\t\t\t\tscreenReaderAnnouncement = true,\n\t\t\t\ttimeout = 10000,\n\t\t\t} = options;\n\n\t\t\tnavigatingTo = href;\n\t\t\tactions.prefetch( pagePath, options );\n\n\t\t\t// Create a promise that resolves when the specified timeout ends.\n\t\t\t// The timeout value is 10 seconds by default.\n\t\t\tconst timeoutPromise = new Promise< void >( ( resolve ) =>\n\t\t\t\tsetTimeout( resolve, timeout )\n\t\t\t);\n\n\t\t\t// Don't update the navigation status immediately, wait 400 ms.\n\t\t\tconst loadingTimeout = setTimeout( () => {\n\t\t\t\tif ( navigatingTo !== href ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tnavigation.isLoading = true;\n\t\t\t\tif ( loadingAnimation ) {\n\t\t\t\t\tnavigation.hasStarted = true;\n\t\t\t\t\tnavigation.hasFinished = false;\n\t\t\t\t}\n\t\t\t\tif ( screenReaderAnnouncement ) {\n\t\t\t\t\ta11ySpeak( 'loading' );\n\t\t\t\t}\n\t\t\t}, 400 );\n\n\t\t\tconst page = yield Promise.race( [\n\t\t\t\tpages.get( pagePath ),\n\t\t\t\ttimeoutPromise,\n\t\t\t] );\n\n\t\t\t// Dismiss loading message if it hasn't been added yet.\n\t\t\tclearTimeout( loadingTimeout );\n\n\t\t\t// Once the page is fetched, the destination URL could have changed\n\t\t\t// (e.g., by clicking another link in the meantime). If so, bail\n\t\t\t// out, and let the newer execution to update the HTML.\n\t\t\tif ( navigatingTo !== href ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tpage &&\n\t\t\t\t! page.initialData?.config?.[ 'core/router' ]\n\t\t\t\t\t?.clientNavigationDisabled\n\t\t\t) {\n\t\t\t\tyield renderRegions( page );\n\t\t\t\twindow.history[\n\t\t\t\t\toptions.replace ? 'replaceState' : 'pushState'\n\t\t\t\t]( {}, '', href );\n\n\t\t\t\t// Update the URL in the state.\n\t\t\t\tstate.url = href;\n\n\t\t\t\t// Update the navigation status once the the new page rendering\n\t\t\t\t// has been completed.\n\t\t\t\tnavigation.isLoading = false;\n\t\t\t\tif ( loadingAnimation ) {\n\t\t\t\t\tnavigation.hasStarted = false;\n\t\t\t\t\tnavigation.hasFinished = true;\n\t\t\t\t}\n\n\t\t\t\tif ( screenReaderAnnouncement ) {\n\t\t\t\t\ta11ySpeak( 'loaded' );\n\t\t\t\t}\n\n\t\t\t\t// Scroll to the anchor if exits in the link.\n\t\t\t\tconst { hash } = new URL( href, window.location.href );\n\t\t\t\tif ( hash ) {\n\t\t\t\t\tdocument.querySelector( hash )?.scrollIntoView();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tyield forcePageReload( href );\n\t\t\t}\n\t\t},\n\n\t\t/**\n\t\t * Prefetches the page with the passed URL.\n\t\t *\n\t\t * The function normalizes the URL and stores internally the fetch\n\t\t * promise, to avoid triggering a second fetch for an ongoing request.\n\t\t *\n\t\t * @param url             The page URL.\n\t\t * @param [options]       Options object.\n\t\t * @param [options.force] Force fetching the URL again.\n\t\t * @param [options.html]  HTML string to be used instead of fetching the requested URL.\n\t\t */\n\t\tprefetch( url: string, options: PrefetchOptions = {} ) {\n\t\t\tconst { clientNavigationDisabled } = getConfig();\n\t\t\tif ( clientNavigationDisabled ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst pagePath = getPagePath( url );\n\t\t\tif ( options.force || ! pages.has( pagePath ) ) {\n\t\t\t\tpages.set(\n\t\t\t\t\tpagePath,\n\t\t\t\t\tfetchPage( pagePath, { html: options.html } )\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t},\n} );\n\n/**\n * Announces a message to screen readers.\n *\n * This is a wrapper around the `@wordpress/a11y` package's `speak` function. It handles importing\n * the package on demand and should be used instead of calling `ally.speak` direacly.\n *\n * @param messageKey The message to be announced by assistive technologies.\n */\nfunction a11ySpeak( messageKey: keyof typeof navigationTexts ) {\n\tif ( ! hasLoadedNavigationTextsData ) {\n\t\thasLoadedNavigationTextsData = true;\n\t\tconst content = document.getElementById(\n\t\t\t'wp-script-module-data-@wordpress/interactivity-router'\n\t\t)?.textContent;\n\t\tif ( content ) {\n\t\t\ttry {\n\t\t\t\tconst parsed = JSON.parse( content );\n\t\t\t\tif ( typeof parsed?.i18n?.loading === 'string' ) {\n\t\t\t\t\tnavigationTexts.loading = parsed.i18n.loading;\n\t\t\t\t}\n\t\t\t\tif ( typeof parsed?.i18n?.loaded === 'string' ) {\n\t\t\t\t\tnavigationTexts.loaded = parsed.i18n.loaded;\n\t\t\t\t}\n\t\t\t} catch {}\n\t\t} else {\n\t\t\t// Fallback to localized strings from Interactivity API state.\n\t\t\t// @todo This block is for Core < 6.7.0. Remove when support is dropped.\n\n\t\t\t// @ts-expect-error\n\t\t\tif ( state.navigation.texts?.loading ) {\n\t\t\t\t// @ts-expect-error\n\t\t\t\tnavigationTexts.loading = state.navigation.texts.loading;\n\t\t\t}\n\t\t\t// @ts-expect-error\n\t\t\tif ( state.navigation.texts?.loaded ) {\n\t\t\t\t// @ts-expect-error\n\t\t\t\tnavigationTexts.loaded = state.navigation.texts.loaded;\n\t\t\t}\n\t\t}\n\t}\n\n\tconst message = navigationTexts[ messageKey ];\n\n\timport( '@wordpress/a11y' ).then(\n\t\t( { speak } ) => speak( message ),\n\t\t// Ignore failures to load the a11y module.\n\t\t() => {}\n\t);\n}\n\n// Add click and prefetch to all links.\nif ( globalThis.IS_GUTENBERG_PLUGIN ) {\n\tif ( navigationMode === 'fullPage' ) {\n\t\t// Navigate on click.\n\t\tdocument.addEventListener(\n\t\t\t'click',\n\t\t\tfunction ( event ) {\n\t\t\t\tconst ref = ( event.target as Element ).closest( 'a' );\n\t\t\t\tif ( isValidLink( ref ) && isValidEvent( event ) ) {\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\tactions.navigate( ref.href );\n\t\t\t\t}\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\t\t// Prefetch on hover.\n\t\tdocument.addEventListener(\n\t\t\t'mouseenter',\n\t\t\tfunction ( event ) {\n\t\t\t\tif ( ( event.target as Element )?.nodeName === 'A' ) {\n\t\t\t\t\tconst ref = ( event.target as Element ).closest( 'a' );\n\t\t\t\t\tif ( isValidLink( ref ) && isValidEvent( event ) ) {\n\t\t\t\t\t\tactions.prefetch( ref.href );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\ttrue\n\t\t);\n\t}\n}\n"],"mappings":"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","ignoreList":[]}