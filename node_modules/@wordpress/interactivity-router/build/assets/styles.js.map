{"version":3,"names":["cssUrlRegEx","resolveUrl","relativeUrl","baseUrl","URL","toString","e","withAbsoluteUrls","cssText","replace","_match","quotes","relUrl1","relUrl2","styleSheetCache","Map","getCachedSheet","sheetId","factory","has","set","get","sheetFromLink","id","href","sheet","elementSheet","sheetUrl","CSSStyleSheet","cssRules","insertRule","Promise","resolve","response","fetch","text","sheetFromStyle","textContent","generateCSSStyleSheets","doc","location","window","querySelectorAll","map","element","nodeName","exports"],"sources":["@wordpress/interactivity-router/src/assets/styles.ts"],"sourcesContent":["const cssUrlRegEx =\n\t/url\\(\\s*(?:([\"'])((?:\\\\.|[^\\n\\\\\"'])+)\\1|((?:\\\\.|[^\\s,\"'()\\\\])+))\\s*\\)/g;\n\nconst resolveUrl = ( relativeUrl: string, baseUrl: string ) => {\n\ttry {\n\t\treturn new URL( relativeUrl, baseUrl ).toString();\n\t} catch ( e ) {\n\t\treturn relativeUrl;\n\t}\n};\n\nconst withAbsoluteUrls = ( cssText: string, baseUrl: string ) =>\n\tcssText.replace(\n\t\tcssUrlRegEx,\n\t\t( _match, quotes = '', relUrl1, relUrl2 ) =>\n\t\t\t`url(${ quotes }${ resolveUrl(\n\t\t\t\trelUrl1 || relUrl2,\n\t\t\t\tbaseUrl\n\t\t\t) }${ quotes })`\n\t);\n\nconst styleSheetCache = new Map< string, Promise< CSSStyleSheet > >();\n\nconst getCachedSheet = async (\n\tsheetId: string,\n\tfactory: () => Promise< CSSStyleSheet >\n) => {\n\tif ( ! styleSheetCache.has( sheetId ) ) {\n\t\tstyleSheetCache.set( sheetId, factory() );\n\t}\n\treturn styleSheetCache.get( sheetId );\n};\n\nconst sheetFromLink = async (\n\t{ id, href, sheet: elementSheet }: HTMLLinkElement,\n\tbaseUrl: string\n) => {\n\tconst sheetId = id || href;\n\tconst sheetUrl = resolveUrl( href, baseUrl );\n\n\tif ( elementSheet ) {\n\t\treturn getCachedSheet( sheetId, () => {\n\t\t\tconst sheet = new CSSStyleSheet();\n\t\t\tfor ( const { cssText } of elementSheet.cssRules ) {\n\t\t\t\tsheet.insertRule( withAbsoluteUrls( cssText, sheetUrl ) );\n\t\t\t}\n\t\t\treturn Promise.resolve( sheet );\n\t\t} );\n\t}\n\treturn getCachedSheet( sheetId, async () => {\n\t\tconst response = await fetch( href );\n\t\tconst text = await response.text();\n\t\tconst sheet = new CSSStyleSheet();\n\t\tawait sheet.replace( withAbsoluteUrls( text, sheetUrl ) );\n\t\treturn sheet;\n\t} );\n};\n\nconst sheetFromStyle = async ( { textContent }: HTMLStyleElement ) => {\n\tconst sheetId = textContent;\n\treturn getCachedSheet( sheetId, async () => {\n\t\tconst sheet = new CSSStyleSheet();\n\t\tawait sheet.replace( textContent );\n\t\treturn sheet;\n\t} );\n};\n\nexport const generateCSSStyleSheets = (\n\tdoc: Document,\n\tbaseUrl: string = ( doc.location || window.location ).href\n): Promise< CSSStyleSheet >[] =>\n\t[ ...doc.querySelectorAll( 'style,link[rel=stylesheet]' ) ].map(\n\t\t( element ) => {\n\t\t\tif ( 'LINK' === element.nodeName ) {\n\t\t\t\treturn sheetFromLink( element as HTMLLinkElement, baseUrl );\n\t\t\t}\n\t\t\treturn sheetFromStyle( element as HTMLStyleElement );\n\t\t}\n\t);\n"],"mappings":"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","ignoreList":[]}